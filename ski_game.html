<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å“ˆçˆ¾æ¿±æ”¯ç·šï½œæ»‘é›ªå¤§å†’éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #0a0c12; color: white; font-family: 'Inter', sans-serif; overflow: hidden; touch-action: none; }
        .snow-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(to bottom, #d6e2f0, #e0f2f7), url('https://i.imgur.com/P5j1w1h.png'), url('https://i.imgur.com/O61WJ7b.png');
            background-repeat: no-repeat; background-size: 100% 100%, 150% auto, 120% auto; background-position: center bottom; z-index: -1;
        }
        #gameCanvas { background: none; display: block; margin: 0 auto; cursor: crosshair; } 
        .ui-panel { 
            position: fixed; 
            inset: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 100; 
            pointer-events: none; 
            background: rgba(0,0,0,0.6); /* åŠé€æ˜é»‘åº•ï¼Œè®“èƒŒæ™¯éš±ç´„å¯è¦‹ */
            backdrop-filter: blur(5px); /* æ¨¡ç³Šæ•ˆæœ */
        }
        
        /* ç¾åŒ–æŒ‰éˆ• */
        .btn-action { 
            pointer-events: auto; 
            background: linear-gradient(145deg, #007bff, #0056b3); /* æ¼¸è®Šè—è‰² */
            color: white; 
            padding: 14px 40px; /* å¢åŠ å…§è· */
            border-radius: 99px; 
            font-weight: bold; 
            font-size: 1.25rem; /* å¢åŠ å­—é«”å¤§å° */
            letter-spacing: 1px; /* å¢åŠ å­—è· */
            transition: all 0.2s ease-in-out; 
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4); /* é™°å½± */
            border: none;
            cursor: pointer;
        }
        .btn-action:hover {
            transform: translateY(-3px); /* æ‡¸åœæ™‚è¼•å¾®ä¸Šæµ® */
            box-shadow: 0 12px 25px rgba(0, 123, 255, 0.5);
        }
        .btn-action:active { 
            transform: scale(0.95); /* é»æ“Šæ™‚ç¸®å° */
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }

        #charSelect {
            width: 90%;
            max-width: 580px;
            margin: 10px auto 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px; /* ç¨å¾®å¢åŠ é–“è· */
            overflow: visible;
        }

/* --- å¡ç‰‡å°ºå¯¸ç¸®å°ï¼Œç¢ºä¿ 3 æ¬„èƒ½åœ¨ä¸€è¡Œæ’é–‹ --- */
.card-container {
    width: 22%; /* è®“å¯¬åº¦é©ä¸­ï¼Œä¸€è¡Œæ’ 3 å€‹ */
    aspect-ratio: 152 / 260;
    cursor: pointer;
    position: relative;
    perspective: 1200px;
}

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .card-container.is-selected .card-inner {
            transform: rotateY(180deg);
        }

        .card-container.is-selected {
            filter: drop-shadow(0 0 15px #e5a400); /* æ›´æ˜é¡¯çš„é¸ä¸­é™°å½± */
            transform: scale(1.15); /* ç¨å¾®æ”¾å¤§ä¸€é» */
            z-index: 10;
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 12px; /* åœ“è§’å†å¤§ä¸€é» */
            background: none !important;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0); /* æ›´æ˜é¡¯çš„é™°å½± */
            border: 1px solid rgba(255, 255, 255, 0); /* æ·ºè‰²é‚Šæ¡† */
            overflow: hidden; /* ç¢ºä¿å…§å®¹ä¸è¶…å‡ºåœ“è§’ */
        }

        .card-front {
            background: linear-gradient(135deg, #1e293b, #0f172a);
        }

        .card-back {
            background: linear-gradient(135deg, #007bff, #0056b3); /* èƒŒé¢ä¹Ÿç”¨æ¼¸è®Š */
            transform: rotateY(180deg);
        }

        .card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 1; /* åœ–ç‰‡ä¸é€æ˜ */
            display: block; /* ç§»é™¤åœ–ç‰‡åº•éƒ¨çš„ç©ºç™½ */
        }

        .card-label {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(0,0,0,0.75); /* æ›´æ·±çš„èƒŒæ™¯è‰² */
            color: white;
            font-size: 11px; /* å­—é«”ç¨å¾®èª¿å¤§ */
            padding: 4px 0; /* å¢åŠ å…§è· */
            backdrop-filter: blur(3px); /* æ¨¡ç³Šæ•ˆæœæ›´å¼· */
            border-bottom-left-radius: 12px; /* é…åˆå¡ç‰‡åœ“è§’ */
            border-bottom-right-radius: 12px;
            font-weight: 600; /* åŠ ç²— */
        }

        /* åˆ†æ•¸é¡¯ç¤ºå„ªåŒ– */
#liveScore {
    font-family: 'Space Mono', monospace;
    font-size: 1.5rem; /* ç¨å¾®ç¸®å°ï¼Œä»¥å…å¤ªæ¶æˆ² */
    font-weight: bold;
    color: #6edaff;
    text-shadow: 0 0 8px rgba(110, 218, 255, 0.5);
}
/* ä¿®æ”¹åˆ†æ•¸é¢æ¿ï¼šç§»å‹•åˆ°å³ä¸Šè§’ */
.score-panel {
    position: fixed;
    top: 20px;
    right: 20px; /* æ”¹ç‚ºé å³ */
    background: rgba(0, 0, 0, 0.4); /* é™ä½é€æ˜åº¦æ›´è¼•ç›ˆ */
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 6px 16px;
    border-radius: 99px;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 8px;
}
/* å¢åŠ ä¸€å€‹ã€ŒSCOREã€å°æ¨™ç±¤æ„Ÿ */
.score-panel::before {
    content: "åˆ†æ•¸";
    font-size: 10px;
    font-weight: 900;
    color: rgba(255, 255, 255, 0.6);
    letter-spacing: 1px;
}


        /* æ¨™é¡Œå‹•ç•« */
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        .title-bounce {
            animation: bounceIn 0.8s ease-out forwards;
        }
        /* ä¿®æ”¹æ¨™é¡Œå­—é«” */
h1.title-bounce {
    font-family: 'Inter', sans-serif;
    font-weight: 900;
    font-style: italic; /* æ–œé«”å¢åŠ é€Ÿåº¦æ„Ÿ */
    color: #93c5fd; /* æ·ºè—è‰² */
    /* åŠ å…¥å¤šé‡é™°å½±æ•ˆæœ */
    text-shadow: 
        2px 2px 0px #1e3a8a, 
        4px 4px 15px rgba(0,0,0,0.5);
}

/* ä¿®æ”¹ä¸‹æ–¹çš„ã€Œæ€¥é€Ÿä¿¯è¡ç‰ˆæœ¬ã€ */
#uiStart p {
    font-family: 'Inter', sans-serif;
    font-weight: 400;
    letter-spacing: 4px; /* å¢åŠ å­—è·ç‡Ÿé€ é«˜ç´šæ„Ÿ */
}

    </style>
</head>
<body>

<div class="snow-bg"></div>

<div id="uiStart" class="ui-panel pointer-events-auto">
    <h1 class="text-5xl font-black italic mb-3 text-blue-300">æ»‘é›ªæŒ‘æˆ°GOï¼ğŸ§Š</h1>
    <p class="text-gray-300 mb-10 text-sm tracking-widest">â„ï¸ äºå¸ƒåŠ›ç‰¹åˆ¥ç‰ˆ â„ï¸</p>
    <div id="charSelect"></div>
    <button onclick="start()" class="btn-action text-xl px-12 py-4">é–‹å§‹æ»‘é›ª</button>
</div>

<div id="uiOver" class="ui-panel hidden pointer-events-auto">
    <h2 class="text-6xl font-black text-red-400 mb-4 italic">æ‘”å€’äº†ï¼</h2>
    <p class="text-2xl mb-10">å¾—åˆ†: <span id="finalScore" class="text-yellow-300">0</span></p>
    <button onclick="location.reload()" class="btn-action bg-red-600">é‡æ–°é–‹å§‹</button>
</div>

<div class="score-panel">
        <span id="liveScore">0</span>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const CHARS = [
        { name: "çˆ¸", file: "1", boardType: "double" },
        { name: "åª½", file: "2", boardType: "double" },
        { name: "å“¥", file: "3", boardType: "single" },
        { name: "è¨€", file: "4", boardType: "double" },
        { name: "å¦¹", file: "5", boardType: "double" },
        { name: "å¼Ÿ", file: "6", boardType: "single" },
        { name: "Vivi", file: "7", boardType: "single" }
    ];

    const OBSTACLE_FILES = ['1.webp', '2.webp', '3.webp'];//éšœç¤™ç‰©
    const charImages = {}, obsImages = {};
// å®šç¾©éšœç¤™ç‰©å±¬æ€§ï¼šå¯¬åº¦ã€é«˜åº¦ã€ä»¥åŠç¢°æ’åŠå¾‘ (radius)
const OBSTACLE_CONFIG = {
    '1.webp': { w: 70, h: 60, r: 25 }, // 1è™Ÿï¼šæ¨¹å¹¹
    '2.webp':  { w: 50, h: 50, r: 20 }, // 2è™Ÿï¼šçŸ³é ­ 
    '3.webp': { w: 70, h: 90, r: 35 }  // 3è™Ÿï¼šæ¨¹
};


    function preloadAssets() {
        CHARS.forEach(c => {
            const img = new Image(); img.src = `images/ski/${c.file}.webp`;
            charImages[c.file] = img;
        });
        OBSTACLE_FILES.forEach(file => {
            const img = new Image(); img.src = `images/obs/${file}`;//éšœç¤™ç‰©åœ–ç‰‡
            obsImages[file] = img;
        });
    }
    preloadAssets();


    

    let particles = [], obstacles = [];
    let selectedIdx = 4, running = false, score = 0, frame = 0, speed = 7;
    let px, py = 150, tx;

function initCharSelect() {
    const menu = document.getElementById('charSelect');
    menu.innerHTML = "";
    menu.style.display = "flex";
    menu.style.flexWrap = "wrap";
    menu.style.justifyContent = "center";

    CHARS.forEach((c, i) => {
        const container = document.createElement('div');
        container.className = `card-container ${i === selectedIdx ? 'is-selected' : ''}`;
        container.id = `char-card-${i}`;
        
        container.innerHTML = `
            <div class="card-inner">
                <div class="card-front">
                    <img src="images/char/${c.file}.webp" class="card-img" alt="${c.name}">
                    <div class="card-label">${c.name}</div>
                </div>
                <div class="card-back">
                    <img src="images/char/${c.file}_real.webp" class="card-img" 
                            onerror="this.src='https://placehold.co/152x260/0056b3/white?text=${c.name}Real'; this.style.backgroundColor='#0056b3';">
                    <div class="card-label">READY!</div>
                </div>
            </div>
        `;

        container.onclick = () => {
            document.querySelectorAll('.card-container').forEach(el => el.classList.remove('is-selected'));
            selectedIdx = i;
            container.classList.add('is-selected');
        };
        menu.appendChild(container);
    });
}

    function resize() {
        canvas.width = Math.min(window.innerWidth, 500);
        canvas.height = window.innerHeight;
        px = tx = canvas.width / 2;
    }

    function start() {
        document.getElementById('uiStart').classList.add('hidden');
        running = true; loop();
    }

    const move = (ex) => {
        if(!running) return;
        const r = canvas.getBoundingClientRect();
        tx = Math.max(40, Math.min(canvas.width-40, (ex - r.left) * (canvas.width / r.width)));
    };
    window.addEventListener('mousemove', e => move(e.clientX));
    window.addEventListener('touchmove', e => move(e.touches[0].clientX));

    function loop() {
        if(!running) return;
        frame++; px += (tx - px) * 0.12;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. é€Ÿåº¦ç·š
        ctx.strokeStyle = '#c5e2f7'; ctx.lineWidth = 2;
        for(let i=0; i<6; i++) {
            let ly = (frame * speed * 0.8 + i * 150) % (canvas.height + 150);
            ctx.beginPath(); ctx.moveTo(i * canvas.width / 5, ly - 50); ctx.lineTo(i * canvas.width / 5, ly + 50); ctx.stroke();
        }

// --- 2. éšœç¤™ç‰© ---
if(frame % Math.max(12, 30 - Math.floor(speed * 0.7)) === 0) {
    const file = OBSTACLE_FILES[Math.floor(Math.random() * OBSTACLE_FILES.length)];
    obstacles.push({ 
        x: Math.random() * (canvas.width - 80) + 40, 
        y: canvas.height + 100, 
        file: file 
    });
}

obstacles.forEach((o, i) => {
    o.y -= speed;
    const img = obsImages[o.file];
    const config = OBSTACLE_CONFIG[o.file] || { w: 60, h: 60, r: 30 }; // å–å¾—é…ç½®ï¼Œè‹¥ç„¡å‰‡çµ¦é è¨­

    if (img && img.complete && img.naturalWidth !== 0) {
        // ğŸ’¡ æ›´æ”¹å¤§å°è™•ï¼šä½¿ç”¨ config.w å’Œ config.h
        // o.x - config.w / 2 æ˜¯ç‚ºäº†è®“åœ–ç‰‡ä¸­å¿ƒå°é½Šåº§æ¨™é»
        ctx.drawImage(img, o.x - config.w / 2, o.y - config.h / 2, config.w, config.h);
    } else {
        ctx.font = "30px Arial"; ctx.textAlign = "center"; ctx.fillText("â›„", o.x, o.y);
    }

    // ğŸ’¡ æ›´æ”¹ç¢°æ’è™•ï¼šä½¿ç”¨ config.r
    // Math.hypot è¨ˆç®—ç©å®¶èˆ‡éšœç¤™ç‰©ä¸­å¿ƒçš„è·é›¢ï¼Œå°æ–¼ config.r åˆ¤å®šæ’åˆ°
    if(Math.hypot(px - o.x, py - o.y) < config.r) {
        running = false; 
        document.getElementById('uiOver').classList.remove('hidden');
        document.getElementById('finalScore').textContent = score;
    }

    if(o.y < -100) { 
        obstacles.splice(i, 1); 
        score++; 
        document.getElementById('liveScore').textContent = score; 
        if(score % 5 === 0) speed += 0.3; 
    }
});

        // 3. ç©å®¶ç³»çµ±
        updateParticlesLogic();
        ctx.save(); ctx.translate(px, py);
        let tilt = Math.max(-0.2, Math.min(0.2, (tx - px) * 0.05));
        let tipSwing = tilt * 30; const boardL = 25;
        drawParticlesRelative();

        // ç¹ªè£½é›ªæ¿
        ctx.save(); ctx.strokeStyle = '#3D3333'; ctx.lineWidth = (CHARS[selectedIdx].boardType === 'double') ? 10 : 25; ctx.lineCap = 'round';
        if (CHARS[selectedIdx].boardType === 'double') {
            const gap = 10;
            ctx.beginPath(); ctx.moveTo(-gap, -25); ctx.lineTo(-gap + tipSwing, boardL); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(gap, -25); ctx.lineTo(gap + tipSwing, boardL); ctx.stroke();
            if (Math.abs(tilt) > 0.05) { addParticle(-gap + tipSwing, 12, -2, 2); addParticle(gap + tipSwing, 12, 2, 2); }
        } else {
            ctx.beginPath(); ctx.moveTo(0, -10); ctx.lineTo(tipSwing, boardL); ctx.stroke();
            if (Math.abs(tilt) > 0.05) addParticle(tipSwing, boardL, -tilt * 10, 2);
        }
        ctx.restore();

        // ç¹ªè£½äººç‰©
        ctx.save(); ctx.rotate(tilt * 0.5);
        const curImg = charImages[CHARS[selectedIdx].file];
        if (curImg && curImg.complete) ctx.drawImage(curImg, -30, -95, 60, 103);
        ctx.restore();

        // ç¹ªè£½å›ºå®šå™¨ (é ‚å±¤)
        ctx.fillStyle = '#222222'; let bindSwing = tipSwing * 0.6;
        if (CHARS[selectedIdx].boardType === 'double') {
            ctx.beginPath(); ctx.roundRect(-16 + bindSwing, -5, 14, 12, 4); ctx.fill();
            ctx.beginPath(); ctx.roundRect(2 + bindSwing, -5, 14, 12, 4); ctx.fill();
        } else {
            ctx.beginPath(); ctx.roundRect(-14 + bindSwing, -4, 14, 9, 3); ctx.fill();
            ctx.beginPath(); ctx.roundRect(0 + bindSwing, -4, 14, 9, 3); ctx.fill();
        }
        ctx.restore();

        requestAnimationFrame(loop);
    }

    function addParticle(x, y, vx, vy) { if (particles.length < 100) particles.push({ x, y, vx, vy, life: 30, alpha: 1 }); }
    function updateParticlesLogic() { particles.forEach((p, i) => { p.x += p.vx; p.y += p.vy; p.y -= speed * 0.5; p.life--; p.alpha = p.life/30; if(p.life<=0) particles.splice(i,1); }); }
    function drawParticlesRelative() { particles.forEach(p => { ctx.save(); ctx.globalAlpha = p.alpha; ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill(); ctx.restore(); }); }

    window.onresize = resize; resize(); initCharSelect();
</script>
</body>
</html>