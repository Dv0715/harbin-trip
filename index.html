<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>哈爾濱回憶錄 | 擦開冰霜開啟旅程</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: -apple-system, sans-serif; }

        /* 背景層 */
        .background-layer {
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                        url('images/cover_bg.jpg') center/cover no-repeat;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 窗外的雪花 */
        #snowCanvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 20;
            pointer-events: none;
            opacity: 0.7;
        }


/* --- 跑步小人系統 --- */
.runner-track {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 120px;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    z-index: 999;
    pointer-events: none;
    transform: scale(0.85);
    transform-origin: bottom center;
    /* ✅ 將 scale 從原本的 0.85 改小，例如 0.5 或 0.6 */
    transform: scale(0.4); 
    
    /* 確保縮放是貼著底邊進行的 */
    transform-origin: bottom center;
    
    /* 如果縮小後覺得太靠近底部，微調此值 */
    margin-bottom: 4.5px;
}

.runner {
    /* ✅ 關鍵：寬度設為長條圖的 1/8 (約 100px)，高度固定 */
    width: 648px; 
    height: 168px;
    background-image: url('images/runners/char00/00.png');
    
    /* ✅ 關鍵：因為是 8 幀大合體，背景大小設為 800% 100% */
    background-size: 700% 100%; 
    image-rendering: pixelated;
    
    /* ✅ 關鍵：steps 設為 8，對應你的 8 張逐格圖 */
    animation: spriteRun 0.55s steps(6) infinite;
}

@keyframes spriteRun {
    from { background-position: 0% 0; }
    to { background-position: 100% 0; }
}

/* 手機版微調：縮小一點點即可，保持比例 */
    @media (max-width: 240px) {
        .runner {
            width: 50px;
            height: 60px;
        }
        .runner-track {
            height: 80px;
            gap: 8px;
        }
    }


    .app-wrap {
      position: relative;
      z-index: 10;
    }




        /* 窗戶冰霜 */
        #frostCanvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            cursor: pointer;
            touch-action: none;
            transition: opacity 0.8s ease-in-out, filter 0.8s ease-in-out;
        }

        /* 轉場啟動 */
        .clearing #frostCanvas {
            opacity: 0;
            filter: blur(55px);
            pointer-events: none;
        }
        .clearing .background-layer {
            transform: scale(1.1);
        }

        /* UI 元件層 */
        .ui-overlay {
            position: fixed;
            inset: 0;
            z-index: 30;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 30px;
        }

        /* 強化後的跳過按鈕 */
        .skip-btn {
            align-self: flex-end;
            pointer-events: auto;
            background: #0071e3;
            color: white;
            padding: 10px 24px;
            border-radius: 99px;
            font-size: 14px;
            font-weight: 800;
            letter-spacing: 0.1em;
            border: 2px solid rgba(255,255,255,0.4);
            box-shadow: 0 8px 20px rgba(0, 113, 227, 0.5);
            transition: all 0.3s ease;
        }
        .skip-btn:hover {
            transform: scale(1.05);
            background: #0082ff;
            border-color: #fff;
        }

        /* 文字強化：黑色膠囊背景 */
.hint-capsule {
        position: fixed;
        bottom: 70px; /* 這裡要比 runner-track 高 */
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(15px);
        padding: 12px 28px;
        border-radius: 99px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        text-align: center;
        color: white;
        pointer-events: none;
        animation: breathe 3s infinite ease-in-out;
    }

    @keyframes spriteRun {
        from { background-position: 0% 0; }
        to { background-position: 100% 0; } 
    }

        .spine-box {
            width: 150px;
            height: 150px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="antialiased">

    <!-- 背景層 -->
    <div class="background-layer">
        <div class="spine-box">
            <span class="text-7xl drop-shadow-2xl">❄️</span>
        </div>
        <p class="text-blue-200 text-xs tracking-[0.4em] font-black uppercase">Harbin Memories</p>
    </div>

    <!-- 窗外雪花 -->
    <canvas id="snowCanvas"></canvas>

    <!-- 窗戶冰霜 -->
    <canvas id="frostCanvas"></canvas>

    <!-- UI 層 -->
    <div class="ui-overlay">
        <button class="skip-btn" onclick="enterSite()">跳過動畫 ➔</button>
        
        <div class="hint-capsule">
            <h2 class="text-xl font-black mb-1 tracking-wider text-white">哈爾濱回憶錄</h2>
            <p class="text-xs font-bold text-blue-300 tracking-[0.15em]">用手擦拭鏡面，撥開漫天冰雪</p>
        </div>
    </div>

    <script>
        const fCanvas = document.getElementById('frostCanvas');
        const fCtx = fCanvas.getContext('2d');
        const sCanvas = document.getElementById('snowCanvas');
        const sCtx = sCanvas.getContext('2d');
        
        let isDrawing = false;
        let hasEntered = false;
        const threshold = 0.38; // 稍微降低門檻，更快進入

        // --- 雪花動畫 ---
        let snowflakes = [];
        function initSnow() {
            sCanvas.width = window.innerWidth;
            sCanvas.height = window.innerHeight;
            snowflakes = Array.from({length: 60}, () => ({
                x: Math.random() * sCanvas.width,
                y: Math.random() * sCanvas.height,
                r: Math.random() * 2 + 1,
                v: Math.random() * 1.2 + 0.6,
                o: Math.random() * 0.6 + 0.3
            }));
        }
        function drawSnow() {
            sCtx.clearRect(0, 0, sCanvas.width, sCanvas.height);
            snowflakes.forEach(s => {
                s.y += s.v;
                s.x += Math.sin(s.y / 40) * 0.5;
                if (s.y > sCanvas.height) s.y = -10;
                sCtx.fillStyle = `rgba(255, 255, 255, ${s.o})`;
                sCtx.beginPath();
                sCtx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
                sCtx.fill();
            });
            requestAnimationFrame(drawSnow);
        }

        // --- 冰霜渲染 ---
        function initFrost() {
            fCanvas.width = window.innerWidth;
            fCanvas.height = window.innerHeight;

            const grad = fCtx.createRadialGradient(
                fCanvas.width/2, fCanvas.height/2, 0,
                fCanvas.width/2, fCanvas.height/2, fCanvas.width
            );
            grad.addColorStop(0, '#f8fafc'); 
            grad.addColorStop(1, '#94a3b8');
            fCtx.fillStyle = grad;
            fCtx.fillRect(0, 0, fCanvas.width, fCanvas.height);

            // 隨機細微冰晶
            fCtx.fillStyle = 'rgba(255,255,255,0.4)';
            for(let i=0; i<1000; i++) {
                fCtx.beginPath();
                fCtx.arc(Math.random()*fCanvas.width, Math.random()*fCanvas.height, Math.random()*1, 0, Math.PI*2);
                fCtx.fill();
            }
            fCtx.globalCompositeOperation = 'destination-out';
        }

        function scratch(x, y) {
            if (hasEntered) return;
            fCtx.lineWidth = 110; // 增加擦拭面積
            fCtx.lineCap = 'round';
            fCtx.lineJoin = 'round';
            fCtx.beginPath();
            fCtx.moveTo(x, y);
            fCtx.lineTo(x + 0.1, y + 0.1);
            fCtx.stroke();
            if (Math.random() > 0.85) checkProgress();
        }

        function checkProgress() {
            const data = fCtx.getImageData(0, 0, fCanvas.width, fCanvas.height).data;
            let cleared = 0;
            const step = 4 * 40; // 優化取樣
            for (let i = 3; i < data.length; i += step) {
                if (data[i] === 0) cleared++;
            }
            if (cleared / (data.length / step) > threshold) enterSite();
        }

        function enterSite() {
            if (hasEntered) return;
            hasEntered = true;
            document.body.classList.add('clearing');
            // ✅ 縮短轉場時間
            setTimeout(() => {
                window.location.href = 'home.html'; 
            }, 900); // 縮短為 0.6 秒
        }

        const getPos = (e) => ({
            x: e.touches ? e.touches[0].clientX : e.clientX,
            y: e.touches ? e.touches[0].clientY : e.clientY
        });
        const start = (e) => { isDrawing = true; const p = getPos(e); scratch(p.x, p.y); };
        const move = (e) => { if(isDrawing) { const p = getPos(e); scratch(p.x, p.y); } };
        const end = () => { isDrawing = false; };

        window.onload = () => {
            initSnow();
            drawSnow();
            initFrost();
        };
        window.onresize = () => { initSnow(); initFrost(); };

        fCanvas.addEventListener('mousedown', start);
        window.addEventListener('mousemove', move);
        window.addEventListener('mouseup', end);
        fCanvas.addEventListener('touchstart', start);
        window.addEventListener('touchmove', move);
        window.addEventListener('touchend', end);
    </script>

<div class="runner-track">
    <div class="runner"></div>
</div>


</body>
</html>