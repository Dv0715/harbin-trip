<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å“ˆçˆ¾æ¿±æ”¯ç·šï½œæ»‘é›ªå¤§å†’éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            background: #0a0c12; 
            color: white; 
            font-family: 'Inter', sans-serif; /* æ›´æ”¹å­—é«” */
            overflow: hidden; 
            touch-action: none; 
        }

        /* é›ªæ™¯èƒŒæ™¯ - é—œéµ CSS */
        .snow-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                /* å±±è„ˆå±¤æ¬¡ */
                linear-gradient(to top, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 10%),
                url('https://i.imgur.com/your-mountain-range-1.png') no-repeat center bottom / 100% auto, /* è¼ƒé çš„å±± */
                url('https://i.imgur.com/your-mountain-range-2.png') no-repeat center bottom / 120% auto, /* è¼ƒè¿‘çš„å±±ï¼Œç¨å¾®å¤§ä¸€é» */
                linear-gradient(to bottom, #d6e2f0, #e0f2f7); /* å¤©ç©ºæ¼¸è®Š */
            background-size: cover, cover, cover, cover; /* ç¢ºä¿èƒŒæ™¯åœ–éƒ½èƒ½é©æ‡‰ */
            background-position: center bottom;
            z-index: -1; /* ç¢ºä¿åœ¨æœ€åº•å±¤ */
        }
        /* æ›¿æ› placeholder åœ–ç‰‡ï¼Œé€™è£¡æˆ‘ç”¨ imgur é€£çµä½œç‚ºç¯„ä¾‹ */
        /* æ‚¨å¯ä»¥ä¸Šå‚³è‡ªå·±çš„å±±è„ˆåœ–ç‰‡ä¸¦æ›¿æ›é€£çµ */
        .snow-bg {
            background-image: 
                linear-gradient(to bottom, #d6e2f0, #e0f2f7), /* å¤©ç©ºæ¼¸è®Š */
                url('https://i.imgur.com/P5j1w1h.png'), /* å±±è„ˆåœ–å±¤ 1 */
                url('https://i.imgur.com/O61WJ7b.png'); /* å±±è„ˆåœ–å±¤ 2 */
            background-repeat: no-repeat;
            background-size: 100% 100%, 150% auto, 120% auto; /* å¤©ç©ºã€é å±±ã€è¿‘å±± */
            background-position: center bottom;
        }


        #gameCanvas { 
            background: none; /* è®“ canvas èƒŒæ™¯é€æ˜ï¼Œé€å‡ºé›ªæ™¯ */
            display: block; 
            margin: 0 auto; 
            cursor: crosshair; 
        } 
        .ui-panel { 
            position: fixed; 
            inset: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 100; 
            pointer-events: none; 
            background: rgba(0,0,0,0.6); /* åŠé€æ˜é»‘åº•ï¼Œè®“èƒŒæ™¯éš±ç´„å¯è¦‹ */
            backdrop-filter: blur(5px); /* æ¨¡ç³Šæ•ˆæœ */
        }
        
        /* ç¾åŒ–æŒ‰éˆ• */
        .btn-action { 
            pointer-events: auto; 
            background: linear-gradient(145deg, #007bff, #0056b3); /* æ¼¸è®Šè—è‰² */
            color: white; 
            padding: 14px 40px; /* å¢åŠ å…§è· */
            border-radius: 99px; 
            font-weight: bold; 
            font-size: 1.25rem; /* å¢åŠ å­—é«”å¤§å° */
            letter-spacing: 1px; /* å¢åŠ å­—è· */
            transition: all 0.2s ease-in-out; 
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4); /* é™°å½± */
            border: none;
            cursor: pointer;
        }
        .btn-action:hover {
            transform: translateY(-3px); /* æ‡¸åœæ™‚è¼•å¾®ä¸Šæµ® */
            box-shadow: 0 12px 25px rgba(0, 123, 255, 0.5);
        }
        .btn-action:active { 
            transform: scale(0.95); /* é»æ“Šæ™‚ç¸®å° */
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }

        #charSelect {
            width: 95%;
            max-width: 500px;
            margin: 10px auto 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px; /* ç¨å¾®å¢åŠ é–“è· */
            overflow: visible;
        }

        .card-container {
            width: 20%; /* èª¿æ•´å¯¬åº¦ï¼Œè®“å¡ç‰‡æ›´ç·Šæ¹Š */
            min-width: 90px; /* æœ€å°å¯¬åº¦èª¿æ•´ */
            aspect-ratio: 152 / 260; /* ä½¿ç”¨å¾®èª¿å¾Œçš„å¯¬é«˜æ¯” */
            cursor: pointer;
            position: relative;
            transition: transform 0.3s ease, filter 0.3s ease; /* å¢åŠ æ¿¾é¡éæ¸¡ */
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .card-container.is-selected .card-inner {
            transform: rotateY(180deg);
        }

        .card-container.is-selected {
            filter: drop-shadow(0 0 15px #e5a400); /* æ›´æ˜é¡¯çš„é¸ä¸­é™°å½± */
            transform: scale(1.15); /* ç¨å¾®æ”¾å¤§ä¸€é» */
            z-index: 10;
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 12px; /* åœ“è§’å†å¤§ä¸€é» */
            background: none !important;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0); /* æ›´æ˜é¡¯çš„é™°å½± */
            border: 1px solid rgba(255, 255, 255, 0); /* æ·ºè‰²é‚Šæ¡† */
            overflow: hidden; /* ç¢ºä¿å…§å®¹ä¸è¶…å‡ºåœ“è§’ */
        }

        .card-front {
            background: linear-gradient(135deg, #1e293b, #0f172a);
        }

        .card-back {
            background: linear-gradient(135deg, #007bff, #0056b3); /* èƒŒé¢ä¹Ÿç”¨æ¼¸è®Š */
            transform: rotateY(180deg);
        }

        .card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 1; /* åœ–ç‰‡ä¸é€æ˜ */
            display: block; /* ç§»é™¤åœ–ç‰‡åº•éƒ¨çš„ç©ºç™½ */
        }

        .card-label {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(0,0,0,0.75); /* æ›´æ·±çš„èƒŒæ™¯è‰² */
            color: white;
            font-size: 11px; /* å­—é«”ç¨å¾®èª¿å¤§ */
            padding: 4px 0; /* å¢åŠ å…§è· */
            backdrop-filter: blur(3px); /* æ¨¡ç³Šæ•ˆæœæ›´å¼· */
            border-bottom-left-radius: 12px; /* é…åˆå¡ç‰‡åœ“è§’ */
            border-bottom-right-radius: 12px;
            font-weight: 600; /* åŠ ç²— */
        }

        /* åˆ†æ•¸é¡¯ç¤ºå„ªåŒ– */
        #liveScore {
            font-family: 'Space Mono', monospace; /* ä½¿ç”¨ç­‰å¯¬å­—é«”æ›´å…·ç§‘æŠ€æ„Ÿ */
            font-size: 2.5rem; /* æ›´å¤§ */
            font-weight: bold;
            color: #6edaff; /* æ·ºè—è‰² */
            text-shadow: 0 0 10px rgba(110, 218, 255, 0.7); /* ç™¼å…‰æ•ˆæœ */
        }
        .score-panel {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* æ¨™é¡Œå‹•ç•« */
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        .title-bounce {
            animation: bounceIn 0.8s ease-out forwards;
        }
        /* ä¿®æ”¹æ¨™é¡Œå­—é«” */
h1.title-bounce {
    font-family: 'Inter', sans-serif;
    font-weight: 900;
    font-style: italic; /* æ–œé«”å¢åŠ é€Ÿåº¦æ„Ÿ */
    color: #93c5fd; /* æ·ºè—è‰² */
    /* åŠ å…¥å¤šé‡é™°å½±æ•ˆæœ */
    text-shadow: 
        2px 2px 0px #1e3a8a, 
        4px 4px 15px rgba(0,0,0,0.5);
}

/* ä¿®æ”¹ä¸‹æ–¹çš„ã€Œæ€¥é€Ÿä¿¯è¡ç‰ˆæœ¬ã€ */
#uiStart p {
    font-family: 'Inter', sans-serif;
    font-weight: 400;
    letter-spacing: 4px; /* å¢åŠ å­—è·ç‡Ÿé€ é«˜ç´šæ„Ÿ */
}

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Kanit:ital,wght@1,900&display=swap" rel="stylesheet">
</head>
<body>

<div class="snow-bg"></div>

<div id="uiStart" class="ui-panel pointer-events-auto">



    <h1 class="text-5xl font-black italic mb-3 text-blue-300 title-bounce">æ»‘é›ªæŒ‘æˆ°GOï¼ğŸ§Š</h1>
    <p class="text-gray-300 mb-10 text-sm uppercase tracking-widest">â„ï¸ äºå¸ƒåŠ›ç‰¹åˆ¥ç‰ˆ â„ï¸</p>
    
    <div id="charSelect"></div>

    <button onclick="start()" class="btn-action text-xl px-12 py-4">é–‹å§‹æ»‘é›ª</button>
</div>

<div id="uiOver" class="ui-panel hidden pointer-events-auto">
    <h2 class="text-6xl font-black text-red-400 mb-4 italic bounce-in">æ‘”å€’äº†ï¼</h2>
    <p class="text-2xl mb-10 text-gray-200">å¾—åˆ†: <span id="finalScore" class="font-bold text-yellow-300">0</span></p>
    <button onclick="location.reload()" class="btn-action text-xl px-10 py-3 bg-red-600 hover:bg-red-700">é‡æ–°é–‹å§‹</button>
</div>

<div class="fixed top-6 left-0 right-0 text-center z-50 pointer-events-none">
    <div class="inline-block score-panel px-6 py-2 rounded-full">
        <span id="liveScore">0</span>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // 1. æ›´æ–°è§’è‰²è³‡æ–™ï¼ˆåŠ å…¥ icon ä¾› Canvas ä½¿ç”¨ï¼‰
    // è¨˜å¾—å°‡ file å¾Œç¶´æ”¹ç‚º .webp
    const CHARS = [
        { name: "çˆ¸çˆ¸", file: "1", icon: "ğŸ‘¨" }, 
        { name: "åª½åª½", file: "2", icon: "ğŸ‘©" },
        { name: "å“¥å“¥", file: "3", icon: "ğŸ‘¦" }, 
        { name: "è¨€",   file: "4", icon: "ğŸ‘±" },
        { name: "æˆ‘",   file: "5", icon: "ğŸ‘§" }, 
        { name: "å¼Ÿ",   file: "6", icon: "ğŸ‘¶" },
        { name: "Vi",   file: "7", icon: "ğŸ‘±â€â™€ï¸" }
    ];

// å»ºç«‹ä¸€å€‹ç‰©ä»¶ä¾†å­˜æ”¾é è¼‰å¥½çš„åœ–ç‰‡
const charImages = {};

function preloadImages() {
    CHARS.forEach(c => {
        const img = new Image();
        img.src = `images/ski/${c.file}.png`;
        charImages[c.file] = img;
    });
}
preloadImages(); // ç«‹å³é–‹å§‹é è¼‰



let selectedIdx = 4;
let running = false;
let score = 0;
let px, py = 150, tx;
let speed = 7;
let obstacles = [];
let frame = 0;

function initCharSelect() {
    const menu = document.getElementById('charSelect');
    menu.innerHTML = "";
    menu.style.display = "flex";
    menu.style.flexWrap = "wrap";
    menu.style.justifyContent = "center";

    CHARS.forEach((c, i) => {
        const container = document.createElement('div');
        container.className = `card-container ${i === selectedIdx ? 'is-selected' : ''}`;
        container.id = `char-card-${i}`;
        
        container.innerHTML = `
            <div class="card-inner">
                <div class="card-front">
                    <img src="images/char/${c.file}.webp" class="card-img" alt="${c.name}">
                    <div class="card-label">${c.name}</div>
                </div>
                <div class="card-back">
                    <img src="images/char/${c.file}_real.webp" class="card-img" 
                            onerror="this.src='https://placehold.co/152x260/0056b3/white?text=${c.name}Real'; this.style.backgroundColor='#0056b3';">
                    <div class="card-label">READY!</div>
                </div>
            </div>
        `;

        container.onclick = () => {
            document.querySelectorAll('.card-container').forEach(el => el.classList.remove('is-selected'));
            selectedIdx = i;
            container.classList.add('is-selected');
        };
        menu.appendChild(container);
    });
}

function resize() {
    canvas.width = Math.min(window.innerWidth, 500);
    canvas.height = window.innerHeight;
    px = tx = canvas.width / 2;
}

function start() {
    document.getElementById('uiStart').classList.add('hidden');
    obstacles = [];
    score = 0;
    speed = 7;
    running = true;
    loop();
}

const move = (ex) => {
    if(!running) return;
    const r = canvas.getBoundingClientRect();
    tx = (ex - r.left) * (canvas.width / r.width);
    tx = Math.max(40, Math.min(canvas.width-40, tx));
};
window.addEventListener('mousemove', e => move(e.clientX));
window.addEventListener('touchmove', e => move(e.touches[0].clientX));

function loop() {
    if(!running) return;
    frame++;
    px += (tx - px) * 0.12;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // é€Ÿåº¦ç·š
    ctx.strokeStyle = '#c5e2f7';
    ctx.lineWidth = 2;
    for(let i=0; i<6; i++) {
        let ly = (frame * speed * 0.8 + i * 150) % (canvas.height + 150);
        ctx.beginPath();
        ctx.moveTo(i * canvas.width / 5, ly - 50); ctx.lineTo(i * canvas.width / 5, ly + 50);
        ctx.stroke();
    }

    // éšœç¤™ç‰©
    if(frame % Math.max(12, 30 - Math.floor(speed * 0.7)) === 0) {
        const obstacleTypes = ['ğŸŒ²', 'ğŸª¨', 'â›„', 'â„ï¸'];
        obstacles.push({
            x: Math.random() * (canvas.width - 80) + 40,
            y: canvas.height + 100,
            type: obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)]
        });
    }

    obstacles.forEach((o, i) => {
        o.y -= speed;
        ctx.font = '45px serif';
        ctx.textAlign = 'center';
        ctx.fillText(o.type, o.x, o.y);

        if(Math.hypot(px - o.x, py - o.y) < 35) {
            running = false;
            document.getElementById('uiOver').classList.remove('hidden');
            document.getElementById('finalScore').textContent = score;
        }

        if(o.y < -100) {
            obstacles.splice(i, 1);
            score++;
            document.getElementById('liveScore').textContent = score;
            if(score % 5 === 0) speed += 0.3;
        }
    });

    // ç¹ªè£½ç©å®¶è§’è‰² (é—œéµä¿®æ”¹å€)
    ctx.save();
    ctx.translate(px, py);
    // æ ¹æ“šç§»å‹•æ–¹å‘æ—‹è½‰
    ctx.rotate(Math.max(-0.2, Math.min(0.2, (tx - px) * 0.05)));
    
    // æ»‘é›ªæ¿
    ctx.fillStyle = '#6edaff';
    ctx.beginPath();
    ctx.roundRect(-30, 30, 60, 10, 5); // ç¨å¾®èª¿å¤§ä¸€é»é…åˆ WebP
    ctx.fill();

    // ç¹ªè£½ WebP åœ–ç‰‡ä»£æ›¿ Emoji
    const currentFile = CHARS[selectedIdx].file;
    const img = charImages[currentFile];
    
    if (img && img.complete) {
        // è¨­å®šåœ–ç‰‡é¡¯ç¤ºå¤§å° (ä¿æŒæ¯”ä¾‹)
        const drawW = 60; 
        const drawH = (260 / 152) * drawW; // ä¾æ“šä½ çš„ 152:260 æ¯”ä¾‹
        // å°‡åœ–ç‰‡ç½®ä¸­ç¹ªè£½ï¼Œåº•éƒ¨å°é½Šæ»‘é›ªæ¿
        ctx.drawImage(img, -drawW/2, -drawH + 35, drawW, drawH);
    } else {
        // è¬ä¸€åœ–ç‰‡é‚„æ²’è¼‰å…¥å¥½ï¼Œç”¨ Emoji ç•¶å‚™æ¡ˆ
        ctx.font = '60px sans-serif';
        ctx.fillText(CHARS[selectedIdx].icon, 0, 10);
    }
    
    ctx.restore();

    requestAnimationFrame(loop);
}

window.onresize = resize;
resize();
initCharSelect();
</script>

</body>
</html>